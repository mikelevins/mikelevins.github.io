<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="Hugo 0.83.1" />
	
	<title>engine of joy - by mikel evins</title>

	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
	<link href="https://mikelevins.github.io//css/bootstrap.min.css" rel="stylesheet">
	<link href="https://mikelevins.github.io//css/strange-case.css" rel="stylesheet">
	

	
	
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

	
	<link href="https://mikelevins.github.io/index.xml" rel="alternate" type="application/rss+xml" title="engine of joy" />
</head>
<body class="scheme-joy">

	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-4 col-md-3 col-lg-3 sidebar">

			
<div class="sidebar-content">

    <a href="https://mikelevins.github.io/"><h1>engine of joy</h1></a>
    <p>by mikel evins</p>

    

    <div class="sidebar-recent">
	<p>Recent Posts</p>
	    
	    
            <div class="tagbutton">
		<a href="/posts/">Posts</a>
            </div>
	    
    </div>

    
    <div class="sidebar-recent">
	<p>Topics</p>
	 
	
	<div class="tagbutton">
	    <a href=/tags/life/ title="All pages with tag <i>life</i>">life</a>
	    <sup>1</sup>
	</div>
	
	 
	
	<div class="tagbutton">
	    <a href=/tags/politics/ title="All pages with tag <i>politics</i>">politics</a>
	    <sup>2</sup>
	</div>
	
	 
	
	<div class="tagbutton">
	    <a href=/tags/programming/ title="All pages with tag <i>programming</i>">programming</a>
	    <sup>12</sup>
	</div>
	
	 
	
	<div class="tagbutton">
	    <a href=/tags/science/ title="All pages with tag <i>science</i>">science</a>
	    <sup>2</sup>
	</div>
	
	 
	
	<div class="tagbutton">
	    <a href=/tags/stoicism/ title="All pages with tag <i>stoicism</i>">stoicism</a>
	    <sup>4</sup>
	</div>
	
	 
	
	<div class="tagbutton">
	    <a href=/tags/stories/ title="All pages with tag <i>stories</i>">stories</a>
	    <sup>5</sup>
	</div>
	
	
    </div>

    
    <div class="sidebar-contact">
	&#187; <a href="mailto:mikel@evins.net">Send mail to mikel</a>
    </div>
    

    <p class="copyright">&copy; 2021. All rights reserved. </p>
    <p class="attr">Powered by <a href="http://gohugo.io">Hugo</a> &amp; <a href="https://github.com/ExchangeRate-API/strange-case">Strange Case</a> (inspired by <a href="https://github.com/poole/hyde">Hyde</a>).</p>

</div>


			</div>
			<div class="col-sm-7 col-sm-offset-4 col-md-6 col-md-offset-3 col-lg-5 col-lg-offset-3 content">

				
				<div class="post">

					<div class="post-heading">
						<h1><a href="https://mikelevins.github.io/posts/2009-07-17-heresy/">Heresy</a></h1>
						<span>Jul 17, 2009</span>
					</div>

					<p>I’m coming to the close of a contract, and I’m spending part time
doing what is natural in that situation: looking for new contracts,
and preparing some of my personal projects for release as products.</p>
<p>The first product scheduled for delivery is a Cocoa application for
Mac OS X. Written in Scheme. This, of course, is heresy.</p>
<p>Cocoa applications are supposed to be written in Objective-C. (Well,
to be fair, about a third of the code in this one is Objective-C. The
rest I wrote in Scheme.)</p>
<p>Why would I do a crazy thing like that?</p>
<p>Well, I like Lisp. I’m a Lisp programmer for a reason, that reason
being that Lisp is the clear winner on the Joy-Per-Unit-Effort
scale. I’m not really partisan in my choice of Lisps. I like Scheme
and Common Lisp and Clojure all just fine. If I ever had a favorite
Lisp, it was Dylan, but it’s been a while since Dylan really felt like
a Lisp.</p>
<p>So I was planning to release this product, and I was looking at
options for packaging it. I could certainly have just written it in
Objective-C. I’ve been using Objective-C and Apple’s development tools
(and NeXT’s development tools before that) for nigh onto twenty years
now. It’s a comfortable and familiar ecosystem. But I figured I’d give
Lisp a fair shot before settling on the conventional choice because,
you know, I like Lisp.</p>
<p>Clojure? Nah; the quick route there is a Swing app. The Java Virtual
Machine has many advantages, but delivering great Cocoa apps is not
one of them. Sure, if you spend enough time and effort, you can
achieve a sort of approximation of a Cocoa UI, but it’s not a fun
process. Less Joy Is Bad.</p>
<p>Common Lisp? Maybe. I love Clozure Common Lisp, and it has a great
Cocoa interface. Only trouble is, universal apps are off the table,
for now. Lispworks? Another good possibility. But my license is
getting a little long in the tooth. If I was going to build a product
on it, I should really get a new license, so I can have the latest
version of Lispworks. And y’know? Right now, end of contract, looking
for new contracts, and other revenue streams&hellip;not the best moment to
spend a few thousand bucks speculatively. Prudence. One learns a
modicum of prudence.</p>
<p>I was experimenting with a few options, and
<a href="http://dynamo.iro.umontreal.ca/~gambit/wiki/index.php/Main_Page">Gambit-C</a>
pleasantly surprised me. Gambit’s been installed on my systems since,
oh, probably since 1990 at least. It’s a great Scheme system that has
gotten steadily better over the years. But there’s not really any
Cocoa support there, or so I thought. Go ahead, Google around; you
won’t find much of anything. Except this:</p>
<p><a href="http://jlongster.com/blog/">http://jlongster.com/blog/</a></p>
<p>It describes how this fellow set up remote debugging of a Gambit app
running on the iPhone. Wait a second; Gambit on the iPhone? Um. Turns
out I know something about iPhone apps. Turns out I’ve written some
iPhone products
(<a href="http://www.iphone4kids.net/2009/06/21/firstwords-learning-how-to-spell/)">http://www.iphone4kids.net/2009/06/21/firstwords-learning-how-to-spell/)</a>. If
this guy has Gambit code running on the iPhone, I’m pretty sure I can
get Gambit code to run a Cocoa app, as well.</p>
<p>In fact, it was a piece of cake.</p>
<p>I had allocated a number of hours spread over a week or so to evaluate
several alternative possibilities before just settling down and
building the app in plain, vanilla Objective-C. After the first
session with Gambit, I cancelled all the other evaluations and just
wrote the app in Gambit.</p>
<p>It’s true that there is no Objective-C interface in Gambit. Turns out
you don’t need one. Gambit has a very good foreign-function
interface&ndash;a C interface really. Gambit compiles Scheme to C code, and
then compiles the resulting C code to native code. One advantage of
this approach, which is used by several other Schemes (Chicken and
Bigloo, for example), is that you can embed C code in your Scheme, and
pretty freely mix the two languages. In point of fact, because Gambit
uses the platform’s C compiler, and because Apple’s C compiler handles
Objective-C, you can in fact embed Objective-C code in your Scheme.</p>
<p>For example,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>application-main
  (<span style="color:#a6e22e">c-lambda</span> () int
&lt;&lt;c-code
   NSApplication *app = [NSApplication sharedApplication]<span style="color:#75715e">;</span>
   NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init]<span style="color:#75715e">;</span>
   [NSBundle loadNibNamed: [[[NSBundle mainBundle] infoDictionary] objectForKey: @<span style="color:#e6db74">&#34;NSMainNibFile&#34;</span>]
             owner: app]<span style="color:#75715e">;</span>
   [app run]<span style="color:#75715e">;</span>
   [pool release]<span style="color:#75715e">;</span>
   ___result = <span style="color:#ae81ff">0</span><span style="color:#75715e">;</span>
c-code
))
</code></pre></div><p>Well, whaddya know? We don’t need no steenking Cocoa interface.</p>
<p>So currently the app is about two thirds Scheme code and one third
Objective-C code. It works great. It launches in under half a second
and loads its test database in about seventy milliseconds. UI
responsiveness and scrolling are as fast as you could possibly want. I
built the UI the conventional way, in Interface Builder, and it calls
into the Scheme code to display and edit data. The delivered app
bundle is 7MB and it’s a universal application that runs on Tiger and
later.</p>
<p>Turns out Gambit is a great platform for Cocoa app development. Who
knew?</p>


				</div>
				

				<div class="text-center">
					
<ul class="pagination">
  <li class="page-item">
    <a href="/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
  </li>
  <li class="page-item">
    <a href="/page/23/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/">1</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/page/2/">2</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/page/3/">3</a>
  </li>
  <li class="page-item disabled">
    <span aria-hidden="true">&nbsp;&hellip;&nbsp;</span>
  </li>
  <li class="page-item">
    <a class="page-link" href="/page/23/">23</a>
  </li>
  <li class="page-item active">
    <a class="page-link" href="/page/24/">24</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/page/25/">25</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/page/26/">26</a>
  </li>
  <li class="page-item">
    <a href="/page/25/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
  </li>
  <li class="page-item">
    <a href="/page/26/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
  </li>
</ul>


				</div>

			</div>
			<div class="col-sm-1 col-md-3 col-md-4">
			</div>
		</div>
	</div>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script src="https://mikelevins.github.io//js/bootstrap.min.js"></script>

</body>
</html>
